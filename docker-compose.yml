version: '3.1'


services:

    app:
        build: 
          context: .
          dockerfile: Dockerfile
        image: electrackapp
        container_name : app
        restart : unless-stopped
        volumes :
            -  ./:/var/www
    app_2:
        build: 
          context: .
          dockerfile: Dockerfile
        image: electrackapp_2
        container_name : app_2
        restart : unless-stopped
        volumes :
            -  ./:/var/www        


    db:
      image: mariadb:10.3
      restart: always
      environment:
        MYSQL_ROOT_PASSWORD: notSecureChangeMe
      volumes: 
        - './.docker/db:/var/lib/mysql'

    phpmyadmin:
        image: phpmyadmin
        restart: always
        ports:
          - 8088:80
        environment:
          - PMA_ARBITRARY=1
          


    webserver:
        build:
          context: .
          dockerfile: dockerfileNginx.DOCKERFILE
        image : nginx
        container_name : webserver
        restart : unless-stopped
        ports :
            - 80:80
        volumes :
            -  ./:/var/www
            - ./config/nginx/:/etc/nginx/conf.d/
        depends_on:
        - app

    webserver_2:
        build:
          context: .
          dockerfile: dockerfileNginx.DOCKERFILE
        image : nginx
        container_name : webserver_2
        restart : unless-stopped
        ports :
            - 82:80
        volumes :
            -  ./:/var/www
            - ./config/nginx/:/etc/nginx/conf.d/
        depends_on:
        - app_2
 
    postfixadmin:
      image: postfixadmin
      ports:
        - 83:80
      restart: always
      depends_on:
        - phpmyadmin

    monitoring:
       image: bitnami/prometheus  
       ports:
         - "9090:9090"
       volumes:
         - ./prometheus.yml:/etc/prometheus/prometheus.yml  

  